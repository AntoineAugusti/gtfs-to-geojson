image: 'rust:latest'

stages:
  - build
  - test
  - format
  - clippy

variables:
  CARGO_HOME: $CI_PROJECT_DIR/cargo

test:
  stage: test
  script:
      - rustc --version
      - cargo --version
      - cargo test --verbose

build:
  stage: build
  script:
      - rustc --version
      - cargo --version
      - cargo build

format:
  stage: format
  script:
    - rustup component add rustfmt --toolchain 1.42.0-x86_64-unknown-linux-gnu
    - cargo-fmt --all --verbose

clippy:
  stage: clippy
  script:
      - cargo clippy --all --verbose -- -D warnings

cache:
  paths:
    - apt/
    - cargo/
    - target/
